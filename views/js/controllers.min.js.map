{"version":3,"file":"routes.js","sources":["routes.js","list/index.js","../treeRender.js","main/view.js"],"names":["define","Lists","actions","index","Trees","viewTree","$","__","helpers","feedback","_addSquareBtn","title","icon","$listToolBar","$btn","class","append","start","saveUrl","_url","delListUrl","delEltUrl","click","$listSaveBtn","$listNewBtn","this","uri","data","$listContainer","$listForm","find","$listTitleBar","length","wrapInner","$labelEdit","val","text","html","replaceWith","attr","elementList","addClass","prepend","sortable","axis","opacity","placeholder","tolerance","update","map","each","id","newName","replace","on","postJson","closest","serializeArray","response","saved","success","_load","getMainContainerSelector","error","level","children","confirm","element","parent","deleted","remove","$list","parents","destroy","network","treeContainer","settings","treeRender","init","container","treeData","options","Element","TypeError","nodes","edges","layout","hierarchical","sortMethod","shape","color","border","background","highlight","font","face","smooth","width","arrows","to","physics","scaling","label","extend","run","binder","context","itemRunnerController","$container","post","$parent","resizeContainer","height","eq","outerHeight","window"],"mappings":"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","sourcesContent":["define('taoBackOffice/controller/routes',[],function () {\n    'use strict';\n\n    return {\n        'Lists' : {\n            'actions' : {\n                'index' : 'controller/list/index'\n            }\n        },\n        'Trees': {\n            'actions': {\n                'viewTree': 'controller/main/view'\n            }\n        }\n    };\n});\n\n","define('taoBackOffice/controller/list/index',['jquery', 'i18n', 'helpers', 'ui/feedback'], function ($, __, helpers, feedback) {\n    'use strict';\n\n    function _addSquareBtn(title, icon, $listToolBar) {\n        var $btn = $('<button>', { 'class': 'btn-info small lft ' +  'icon-'+ icon, title: __(title) });\n        $listToolBar.append($btn);\n        return $btn;\n    }\n\n    return {\n\n        start: function () {\n\n            var saveUrl = helpers._url('saveLists', 'Lists', 'taoBackOffice');\n            var delListUrl = helpers._url('removeList', 'Lists', 'taoBackOffice');\n            var delEltUrl = helpers._url('removeListElement', 'Lists', 'taoBackOffice');\n\n            $(\".list-edit-btn\").click(function () {\n                var $btn = $(this),\n                    uri = $btn.data('uri'),\n                    $listContainer = $(\"#list-data_\" + uri ),\n                // form must be on the inside rather than on the outside as it has been in 2.6\n                    $listForm     = $listContainer.find('form'),\n                    $listTitleBar = $listContainer.find('.container-title h6'),\n                    $listToolBar  = $listContainer.find('.data-container-footer'),\n                    $listSaveBtn,\n                    $listNewBtn;\n\n                if (!$listForm.length) {\n\n                    $listForm = $('<form>');\n                    $listContainer.wrapInner($listForm);\n                    $listContainer.find('form').append('<input type=\"hidden\" name=\"uri\" value=\"' + uri + '\" />');\n\n                    var $labelEdit = $(\"<input type='text' name='label' value=''/>\").val($listTitleBar.text());\n                    $listTitleBar.html($labelEdit);\n\n                    if ($listContainer.find('.list-element').length) {\n                        $listContainer.find('.list-element').replaceWith(function () {\n                            return $(\"<input type='text' name='\" + $(this).attr('id') + \"' value='' />\").val($(this).text());\n                        });\n                    }\n\n                    var elementList = $listContainer.find('ol');\n                    elementList.addClass('sortable-list');\n                    elementList.find('li').prepend('<span class=\"icon-grip\" ></span>');\n                    elementList.find('li').append('<span class=\"icon-checkbox-crossed list-element-delete-btn\" style=\"cursor:pointer;\" ></span>');\n\n                    elementList.sortable({\n                        axis: 'y',\n                        opacity: 0.6,\n                        placeholder: 'ui-state-error',\n                        tolerance: 'pointer',\n                        update: function (event, ui) {\n                            var map = {};\n                            $.each($(this).sortable('toArray'), function (index, id) {\n                                map[id] = 'list-element_' + (index + 1);\n                            });\n                            $(this).find('li').each(function () {\n                                var id = $(this).attr('id');\n                                if (map[id]) {\n                                    $(this).attr('id', map[id]);\n                                    var newName = $(this).find('input').attr('name').replace(id, map[id]);\n                                    $(this).find('input').attr('name', newName);\n                                }\n                            });\n                        }\n                    });\n\n                    $listSaveBtn = _addSquareBtn('Save element', 'save', $listToolBar);\n                    $listSaveBtn.on('click', function () {\n                        $.postJson(\n                            saveUrl,\n                            $(this).closest('form').serializeArray(),\n                            function (response) {\n                                if (response.saved) {\n                                    feedback().success(__('\"list saved\"'));\n                                    helpers._load(helpers.getMainContainerSelector(), helpers._url('index', 'Lists', 'taoBackOffice'));\n                                }else{\n                                    feedback().error(__('List not saved'));\n                                }\n                            }\n                        );\n                        return false;\n                    });\n\n                    $listNewBtn = _addSquareBtn('New element', 'add', $listToolBar);\n                    $listNewBtn.click(function () {\n                        var level = $(this).closest('form').find('ol').children().length + 1;\n                        $(this).closest('form').find('ol').append(\n                            \"<li id='list-element_\" + level + \"'>\" +\n                            \"<span class='icon-grip' ></span>\" +\n                            \"<input type='text' name='list-element_\" + level + \"_' />\" +\n                            \"<span class='icon-add list-element-delete-btn' ></span>\" +\n                            \"</li>\");\n                        return false;\n                    });\n                }\n\n                $(\".list-element-delete-btn\").click(function () {\n                    var $btn = $(this),\n                        uri = $btn.data('uri');\n                    if (confirm(__(\"Please confirm you want to delete this list element.\"))) {\n                        var element = $(this).parent();\n                        uri = element.find('input:text').attr('name').replace(/^list\\-element\\_([1-9]*)\\_/, '');\n                        $.postJson(\n                            delEltUrl,\n                            {uri: uri},\n                            function (response) {\n                                if (response.deleted) {\n                                    element.remove();\n                                    feedback().success(__('Element deleted'));\n                                }else{\n                                    feedback().error(__('Element not deleted'));\n                                }\n                            }\n                        );\n                    }\n                });\n            });\n\n            $('.list-delete-btn').click(function () {\n                if (confirm(__(\"Please confirm you want to delete this list. This operation cannot be undone.\"))) {\n                    var $btn = $(this),\n                        uri = $btn.data('uri'),\n                        $list = $(this).parents(\".data-container\");\n                    $.postJson(\n                        delListUrl,\n                        {uri: uri},\n                        function (response) {\n                            if (response.deleted) {\n                                feedback().success(__('List deleted'));\n                                $list.remove();\n                            }else{\n                                feedback().error(__('List not deleted'));\n                            }\n                        }\n                    );\n                }\n            });\n        }\n    };\n});\n\n","define('taoBackOffice/treeRender',[\n    'jquery',\n    'lodash',\n    //'taoBackOffice/lib/vis/vis',\n    //'css!taoBackOffice/lib/vis/vis'\n], function ($, _, vis) {\n    'use strict';\n\n    var network = null;\n    var treeContainer = null;\n    var settings = null;\n    var data = null;\n\n    /**\n     * @private\n     */\n    function destroy() {\n        if (network !== null) {\n            network.destroy();\n            network = null;\n        }\n    }\n\n    var treeRender = {\n\n        /**\n         *\n         * @param {Element} container\n         * @param {Object} [treeData]\n         * @param {Object} [options]\n         */\n        init: function (container, treeData, options) {\n\n            if (!container instanceof Element) {\n                throw new TypeError(\"tree container must be specified\");\n            }\n\n            treeContainer = container;\n            options = options || {};\n            treeData = treeData || {nodes: [], edges: []};\n\n\n            settings = {\n                layout: {\n                    hierarchical: {\n                        sortMethod: 'directed'\n                    }\n                },\n                nodes: {\n                    shape: 'box',\n                    \"color\": {\n                        \"border\": \"#222\",\n                        \"background\": \"#f2f0ee\",\n\n                        \"highlight\": {\n                            \"border\": \"#222\",\n                            \"background\": \"#f2f0ee\"\n                        }\n                    },\n\n                    \"font\": {\n                        \"face\": \"'Franklin Gothic', 'Franklin Gothic Medium', 'Source Sans Pro', sans-serif\",\n                        \"color\": \"#222\"\n                    }\n\n                },\n                edges: {\n                    smooth: false,\n                    width: 0.2,\n                    color: {\n                        color: \"#222\"\n                    },\n                    arrows: {to: true},\n                    \"physics\": false,\n                    \"scaling\": {\n                        \"label\": false\n                    }\n                }\n            };\n\n            $.extend(settings, options);\n\n            // create a network\n            data = {\n                nodes: treeData.nodes ? treeData.nodes : [],\n                edges: treeData.edges ? treeData.edges : []\n            };\n\n        },\n\n        run: function () {\n            destroy();\n\n            //network = new vis.Network(treeContainer, data, settings);\n\n        }\n    };\n\n    return treeRender;\n});\n","define('taoBackOffice/controller/main/view',[\n    'layout/actions/binder',\n    'uri',\n    'jquery',\n    'context',\n    'helpers',\n    'taoBackOffice/treeRender'\n], function (binder, uri, $, context, helpers, treeRender) {\n    'use strict';\n\n    /**\n     *\n     * @type {{start: Function}}\n     */\n    var itemRunnerController = {\n\n        //the controller initialization\n        start: function () {\n\n            var $container = $('#tree-container');\n            var uri = $container.data('uri');\n\n            $.post(helpers._url('getTree', 'Trees', 'taoBackOffice'), {uri: uri}, function (treeData) {\n\n                var $parent = $container.closest('.content-block');\n\n                var resizeContainer = function () {\n                    $container.height($parent.height() - $parent.find('.panel').eq(0).outerHeight());\n                    $container.width($parent.width());\n                };\n\n                $(window).on('resize', resizeContainer);\n\n                resizeContainer();\n                treeRender.init($container[0], treeData);\n                treeRender.run();\n\n            });\n        }\n    };\n\n    // the controller is exposed\n    return itemRunnerController;\n});\n"]}