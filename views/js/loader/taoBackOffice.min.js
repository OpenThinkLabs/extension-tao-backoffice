define("css!taoBackOfficeCss/list",[],function(){}),define("taoBackOffice/controller/list/index",["jquery","i18n","util/url","ui/feedback","ui/dialog/confirm","layout/section","css!taoBackOfficeCss/list"],function($,__,urlUtil,feedback,dialogConfirm,section){'use strict';function addSquareBtn(title,icon,$listToolBar){var position=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"lft",$btn=$("<button>",{class:"btn-info small ".concat(position," icon-").concat(icon),title:__(title)});return $listToolBar.append($btn),$btn}return{start:function start(){var saveUrl=urlUtil.route("saveLists","Lists","taoBackOffice"),delListUrl=urlUtil.route("removeList","Lists","taoBackOffice"),delEltUrl=urlUtil.route("removeListElement","Lists","taoBackOffice");$(".list-edit-btn").click(function(){var $listSaveBtn,$listNewBtn,$btn=$(this),uri=$btn.data("uri"),$listContainer=$("#list-data_".concat(uri)),$listForm=$listContainer.find("form"),$listTitleBar=$listContainer.find(".container-title h6"),$listToolBar=$listContainer.find(".data-container-footer");if($btn.addClass("hidden"),!$listForm.length){$listForm=$("<form>"),$listContainer.wrapInner($listForm),$listContainer.find("form").append("<input type='hidden' name='uri' value='".concat(uri,"' />"));var $labelEdit=$("<input type='text' name='label' value=''/>").val($listTitleBar.text());$listTitleBar.html($labelEdit),$listContainer.find(".list-element").length&&$listContainer.find(".list-element").replaceWith(function(){return $("<input type='text' name='".concat($(this).attr("id"),"' value='' />")).val($(this).text())});var elementList=$listContainer.find("ol");elementList.addClass("sortable-list"),elementList.find("li").append("<span class='icon-checkbox-crossed list-element-delete-btn'></span>"),$listSaveBtn=addSquareBtn(__("Save list"),"save",$listToolBar,"rgt"),$listSaveBtn.on("click",function(){return $.postJson(saveUrl,$(this).closest("form").serializeArray(),function(response){response.saved?(feedback().success(__("List saved")),section.get("taoBo_list").loadContentBlock(urlUtil.route("index","Lists","taoBackOffice"))):feedback().error(__("List not saved"))}),!1}),$listNewBtn=addSquareBtn("New element","add",$listToolBar),$listNewBtn.click(function(){var level=$(this).closest("form").find("ol").children().length+1;return $(this).closest("form").find("ol").append("<li id='list-element_".concat(level,"'>\n                                <input type='text' name='list-element_").concat(level,"_' />\n                                <span class='icon-checkbox-crossed list-element-delete-btn' ></span>\n                            </li>")),!1})}$listContainer.on("click",".list-element-delete-btn",function(){var $element=$(this).parent(),$input=$element.find("input:text"),eltUri=$input.attr("name").replace(/^list-element_([0-9]*)_/,""),deleteLocalElement=function(){$element.remove(),feedback().success(__("Element deleted"))},deleteServerAndLocalElement=function(){$.postJson(delEltUrl,{uri:eltUri},function(response){response.deleted?deleteLocalElement():feedback().error(__("Element not deleted"))})},deleteElement=function(){eltUri?deleteServerAndLocalElement():deleteLocalElement()};""===$input.val()?deleteElement():dialogConfirm(__("Please confirm you want to delete this list element."),deleteElement)})}),$(".list-delete-btn").click(function(){var $btn=$(this);dialogConfirm(__("Please confirm you want to delete this list. This operation cannot be undone."),function(){var uri=$btn.data("uri"),$list=$btn.parents(".data-container");$.postJson(delListUrl,{uri:uri},function(response){response.deleted?(feedback().success(__("List deleted")),$list.remove()):feedback().error(__("List not deleted"))})})})}}}),define("taoBackOffice/controller/routes",[],function(){'use strict';return{Lists:{actions:{index:"controller/list/index"}},Trees:{actions:{viewTree:"controller/tree/view"}}}}),define("taoBackOffice/treeRender",["jquery","lodash","taoBackOffice/lib/vis/vis","css!taoBackOffice/lib/vis/vis"],function($,_,vis){'use strict';function destroy(){null!==network&&(network.destroy(),network=null)}var network=null,treeContainer=null,settings=null,data=null;return{init:function init(container,treeData,options){if(!container instanceof Element)throw new TypeError("tree container must be specified");treeContainer=container,options=options||{},treeData=treeData||{nodes:[],edges:[]},settings={layout:{hierarchical:{sortMethod:"directed",levelSeparation:200}},nodes:{shape:"box",color:{border:"#222",background:"#f2f0ee",highlight:{border:"#222",background:"#f2f0ee"}},font:{face:"'Franklin Gothic', 'Franklin Gothic Medium', 'Source Sans Pro', sans-serif",color:"#222"}},edges:{smooth:!1,width:.2,color:{color:"#222"},arrows:{to:!0},physics:!1,scaling:{label:!1}}},$.extend(settings,options),data={nodes:treeData.nodes?treeData.nodes:[],edges:treeData.edges?treeData.edges:[]}},run:function run(){destroy(),network=new vis.Network(treeContainer,data,settings),network.once("initRedraw",function(){100<data.nodes.length&&(network.setOptions($.extend(settings,{physics:{hierarchicalRepulsion:{nodeDistance:200},stabilization:{fit:!1}}})),network.fit({nodes:[data.nodes[0].id,data.nodes[1].id],animation:{duration:400,easingFunction:"linear"}}))})}}}),define("taoBackOffice/controller/tree/view",["layout/actions/binder","uri","jquery","context","helpers","taoBackOffice/treeRender"],function(binder,uri,$,context,helpers,treeRender){'use strict';return{start:function start(){$(".tree-container").each(function(i,obj){var $container=$(obj),uri=$container.data("id");$.post(helpers._url("getTree","Trees","taoBackOffice"),{uri:uri},function(treeData){var $parent=$container.closest(".content-block"),resizeContainer=function(){$container.height($parent.height()-$parent.find(".panel").eq(0).outerHeight()),$container.width($parent.width())};$(window).on("resize",resizeContainer),resizeContainer(),treeRender.init($container[0],treeData),treeRender.run()})})}}}),function(c){var d=document,s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0].appendChild(s),s.styleSheet?s.styleSheet.cssText=c:s.appendChild(d.createTextNode(c))}(".list-container .list-element-delete-btn{cursor:pointer}\n\n/*# sourceMappingURL=list.css.map */"),define("taoBackOffice/loader/taoBackOffice.bundle",function(){});
//# sourceMappingURL=taoBackOffice.min.js.map